<html>
	<body>
		<div id="content"></div>
		<script type="text/javascript" src="./js/uni.webview.1.5.1.js"></script>
		<script type="text/javascript">
			//获取url参数
			function getQueryVariable (variable) {
			       var query = window.location.search.substring(1);
			       var vars = query.split("&");
			       for (var i=0;i<vars.length;i++) {
			            var pair = vars[i].split("=");
			            if(pair[0] == variable){return pair[1];}
			       }
			       return(false);
			}
			//获取mangabz漫画内容
			function getMangabzContent () {
				var child = document.getElementById('myIframe').contentWindow;
				var lazy = child.document.getElementsByClassName('lazy');
				var images = new Array(lazy.length);
				for ( var i = 0; i < lazy.length; i++ ) {
					images[i] = {
						path: lazy[i].getAttribute('data-src'),
						imageWidth: lazy[0].naturalWidth,
						imageHeight: lazy[0].naturalHeight,
					}
				};
				return images;
			}
			
			window.onload = function () {
				window.setTimeout( function () {
					//创建一个iframe元素加载漫画内容
					var iframe = document.createElement("iframe");
					iframe.src = getQueryVariable('url');
					iframe.id = 'myIframe';
					iframe.style.width = '100%';
					iframe.style.height = '100%';
					iframe.style.opacity = '0';
					//等待iframe加载完毕
					iframe.onload = function(){
						var data = [];
						if ( getQueryVariable('source') == 'mangabz' ) {
							data = getMangabzContent();
						}
						uni.postMessage({
						    data: data
						});
					};
					document.getElementById("content").appendChild(iframe);
				}, 1000)
			}
		</script>
	</body>
</html>